<script>
var app = new Vue({
  el: '#app',
  delimiters: ['${', '}'],
  data: {
    newTask: '',
    tasks: [],
    isLoading: false
  },
  methods: {
    loadTasks: function(){
      this.isLoading = true;

      axios.get('/tasks')
      .then((result) => {
        this.logResult(result);
        this.tasks = result.data.tasks;
        this.isLoading = false;
      });
    },

    addTask: function(){
      if(this.newTask == '')
        return;

      axios.post('/tasks', { title: this.newTask })
      .then((result) => {
        this.logResult(result);
        this.newTask = '';

        this.loadTasks();
      });
    },

    switchTask: function(task){
      this.isLoading = true;

      axios.put(`/task/${task._id}`, {
        newTaskData:{
          isDone: !task.isDone
        }
      })
      .then((result) => {
        this.logResult(result);
        task.isDone = !task.isDone;
        this.isLoading = false;

        this.loadTasks();
      });
    },

    removeTask: function(task, taskIndex){
      this.isLoading = true;

      axios.delete(`/task/${task._id}`)
      .then((result) => {
        this.logResult(result);
        this.tasks.splice(taskIndex, 1);
        this.isLoading = false;

        this.loadTasks();
      });
    },

    logResult: function(result){
      if(result.data.message != ''){
        console.log(`SUCCESS: ${result.data.message}`);
      }
    }
  },
   beforeMount(){
      this.loadTasks();
   },
});
</script>
